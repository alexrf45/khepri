---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: wallabag-dev-cluster
  namespace: wallabag
  labels:
    app: "wallabag"
    node: "worker"
    env: "dev"
spec:
  imageName: ghcr.io/cloudnative-pg/postgresql:17
  postgresql:
    pg_hba:
      - hostssl wallabag wallabag 10.43.0.0/16 scram-sha-256
  instances: 2
  superuserSecret:
    name: wallabag-dev-db-creds
  storage:
    size: 5Gi
    storageClass: local-path
  walStorage:
    size: 2Gi
    storageClass: local-path
  # bootstrap:
  #   recovery:
  #     source: wallabag-dev-cluster
  #     database: wallabag
  #     owner: wallabag
  #     secret:
  #       name: wallabag-dev-db-creds
  # plugins:
  # - name: barman-cloud.cloudnative-pg.io
  #   isWALArchiver: true
  #   parameters:
  #     barmanObjectName: wallabag-dev-cluster-2026
  # externalClusters:
  # - name: wallabag-dev-cluster
  #   plugin:
  #     name: barman-cloud.cloudnative-pg.io
  #     parameters:
  #       barmanObjectName: wallabag-dev-cluster-backup
# ---
# apiVersion: postgresql.cnpg.io/v1
# kind: ScheduledBackup
# metadata:
#   name: wallabag-dev-backup
#   namespace: wallabag
# spec:
#   schedule: "0 0 * * *"
#   cluster:
#     name: wallabag-dev-cluster
#   backupOwnerReference: self
#   method: plugin
#   pluginConfiguration:
#     name: barman-cloud.cloudnative-pg.io
#   immediate: true
